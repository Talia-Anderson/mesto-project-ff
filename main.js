(()=>{"use strict";function e(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"bbcf2270-d3d0-40fa-b649-4e22b6be7820","Content-Type":"application/json"}},n=function(n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:t.headers}).then((function(t){return e(t)}))},o=function(n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:t.headers}).then((function(t){return e(t)}))},r=function(n){return fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(t){return e(t)}))};function c(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function i(e,t,r){e.classList.contains("card__like-button_is-active")?o(t).then((function(t){e.classList.toggle("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(e){return console.log(e)})):n(t).then((function(t){e.classList.toggle("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(e){return console.log(e)}))}function l(e,t){var n=e.target.closest(".places__item");r(t).then((function(e){n.remove()})).catch((function(e){return console.log(e)}))}var s=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)},d=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},p=function(e,t){console.log(t);var n=e.querySelector(t.submitButtonSelector),o=Array.from(e.querySelectorAll(t.inputSelector));o.forEach((function(n){console.log(n),n.classList.remove(t.inputErrorClass),n.value="",s(e,n,t)})),d(o,n,t)},f=document.querySelector(".places__list");function _(e){var t=function(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__title"),a=c.querySelector(".card__image"),i=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button");a.src=e.link,a.alt=e.name,u.textContent=e.name;var s=c.querySelector("#counter");return s.textContent=e.likes.length,function(e,t){for(var n=!1,o=0;o<e.likes.length&&1!=n;o+=1)e.likes[o]._id===t&&(n=!0);return n}(e,r)&&l.classList.toggle("card__like-button_is-active"),i.addEventListener("click",(function(n){t(n,e.cardID)})),l.addEventListener("click",(function(){n(l,e.cardID,s)})),e.ownerID===r&&i.classList.remove("hidden"),a.addEventListener("click",(function(t){o(e)})),c}(e,l,i,F,m);f.prepend(t)}var m,y,v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},h=document.querySelector(".popup_type_image"),S=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),q=Array.from(document.querySelectorAll(".popup")),k=document.querySelector(".popup_type_edit"),g=document.querySelector(".popup_type_new-card"),C=g.querySelector(".popup__form"),E=k.querySelector(".popup__form"),L=E.querySelector(".popup__input_type_name"),x=E.querySelector(".popup__input_type_description"),D=document.querySelector(".overlay"),w=document.querySelector(".popup_type_new-avatar"),A=w.querySelector(".popup__form"),U=A.querySelector("#popup__input-avatar"),I=w.querySelector(".popup__button"),T=k.querySelector(".popup__button"),B=g.querySelector(".popup__button"),P=document.querySelector("#avatar"),N=document.querySelector("#about"),O=document.querySelector("#name"),j=document.querySelector(".profile__title"),J=document.querySelector(".profile__description"),M=h.querySelector(".popup__caption"),H=h.querySelector(".popup__image"),V=C.querySelector(".popup__input_type_card-name"),z=C.querySelector(".popup__input_type_url");function F(e){M.textContent=e.name,H.src=e.link,H.alt=e.name,a(h)}D.addEventListener("click",(function(){a(w),p(A,v)})),S.addEventListener("click",(function(){p(E,v),L.value=j.textContent,x.value=J.textContent,a(k)})),b.addEventListener("click",(function(){a(g),p(C,v)})),q.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return u(e)})),e.addEventListener("click",(function(t){t.target===e&&u(e)}))})),A.addEventListener("submit",(function(n){n.preventDefault(),I.textContent="Сохранение...",function(n){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n.value})}).then((function(t){return e(t)}))}(U).then((function(e){P.style.backgroundImage="url(".concat(e.avatar,")"),u(w)})).catch((function(e){return console.log(e)})).finally((function(e){return I.textContent="Сохранить"}))})),E.addEventListener("submit",(function(n){n.preventDefault(),T.textContent="Сохранение...",function(n,o){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n.value,about:o.value})}).then((function(t){return e(t)}))}(L,x).then((function(e){j.textContent=L.value,J.textContent=x.value,u(k)})).catch((function(e){return console.log(e)})).finally((function(e){return T.textContent="Сохранить"}))})),C.addEventListener("submit",(function(n){var o;n.preventDefault(),B.textContent="Сохранение...",function(n,o){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n.value,link:o.value})}).then((function(t){return e(t)}))}(V,z).then((function(e){o={name:e.name,link:e.link,likes:e.likes,ownerID:e.owner._id,cardID:e._id}})).then((function(e){_(o),u(g)})).finally((function(e){B.textContent="Сохранить"})).catch((function(e){return console.log(e)}))})),y=v,console.log(y),Array.from(document.querySelectorAll(y.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);d(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){if(t.validity.patternMismatch){var o=t.dataset.errorMessage;t.setCustomValidity(o)}else t.setCustomValidity("");t.validity.valid?s(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add("".concat(o.inputErrorClass)),r.textContent=n,r.classList.add("".concat(o.errorClass))}(e,t,t.validationMessage,n)}(e,r,t),d(n,o,t)}))}))}(e,y)})),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(t){return e(t)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(t){return e(t)}))]).then((function(e){O.textContent=e[0].name,N.textContent=e[0].about,P.style.backgroundImage="url(".concat(e[0].avatar,")"),m=e[0]._id,e[1].forEach((function(e){_({name:e.name,link:e.link,likes:e.likes,ownerID:e.owner._id,cardID:e._id})}))})).catch((function(e){console.log(e)}))})();