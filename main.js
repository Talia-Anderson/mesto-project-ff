(()=>{"use strict";function e(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"bbcf2270-d3d0-40fa-b649-4e22b6be7820","Content-Type":"application/json"}},n=function(n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:t.headers}).then((function(t){return e(t)}))},o=function(n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:t.headers}).then((function(t){return e(t)}))},r=function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers})};function c(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function i(e,t,r){e.classList.contains("card__like-button_is-active")?o(t).then((function(t){e.classList.toggle("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(e){return console.log(e)})):n(t).then((function(t){e.classList.toggle("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(e){return console.log(e)}))}function l(e,t){var n=e.target.closest(".places__item");r(t).then((function(e){n.remove()}))}var s=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},d=function(e,t){console.log(t),Array.from(e.querySelectorAll(t.submitButtonSelector)).forEach((function(e){e.classList.add(t.inactiveButtonClass)})),Array.from(e.querySelectorAll("span")).forEach((function(e){e.classList.remove(t.errorClass),e.textContent=""})),Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(e){console.log(e),e.classList.remove(t.inputErrorClass),e.value=""}))},p=document.querySelector(".places__list");function f(e){var t=function(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__title"),a=c.querySelector(".card__image"),i=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button");a.src=e.link,a.alt=e.name,u.textContent=e.name;var s=c.querySelector("#counter");return s.textContent=e.likes.length,function(e,t){for(var n=!1,o=0;o<e.likes.length&&1!=n;o+=1)e.likes[o]._id===t&&(n=!0);return n}(e,r)&&l.classList.toggle("card__like-button_is-active"),i.addEventListener("click",(function(n){t(n,e.cardID)})),l.addEventListener("click",(function(){n(l,e.cardID,s)})),e.ownerID===r&&i.classList.remove("hidden"),a.addEventListener("click",(function(t){o(e)})),c}(e,l,i,N,_);p.prepend(t)}var _,m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},y=document.querySelector(".popup_type_image"),v=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),S=Array.from(document.querySelectorAll(".popup")),q=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_new-card"),k=b.querySelector(".popup__form"),C=q.querySelector(".popup__form"),g=C.querySelector(".popup__input_type_name"),E=C.querySelector(".popup__input_type_description"),L=document.querySelector(".overlay"),x=document.querySelector(".popup_type_new-avatar"),A=x.querySelector(".popup__form"),D=A.querySelector("#popup__input-avatar"),w=x.querySelector(".popup__button"),U=q.querySelector(".popup__button"),I=b.querySelector(".popup__button"),B=document.querySelector("#avatar"),T=document.querySelector("#about"),P=document.querySelector("#name");function N(e){var t=y.querySelector(".popup__caption"),n=y.querySelector(".popup__image");t.textContent=e.name,n.src=e.link,n.alt=e.name,a(y)}L.addEventListener("click",(function(){a(x),d(A,m)})),v.addEventListener("click",(function(){d(C,m);var e=document.querySelector(".profile__title"),t=document.querySelector(".profile__description");g.value=e.textContent,E.value=t.textContent,a(q)})),h.addEventListener("click",(function(){a(b),d(k,m)})),S.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return u(e)})),e.addEventListener("click",(function(t){t.target===e&&u(e)}))}));var O,j=document.querySelector(".profile__title"),J=document.querySelector(".profile__description");A.addEventListener("submit",(function(n){n.preventDefault(),w.textContent="Сохранить",w.textContent="Сохранение...",function(n){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n.value})}).then((function(t){return e(t)}))}(D).then((function(e){B.style.backgroundImage="url(".concat(e.avatar,")"),u(x)})).catch((function(e){return console.log(e)}))})),C.addEventListener("submit",(function(n){n.preventDefault(),U.textContent="Сохранить",U.textContent="Сохранение...",function(n,o){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n.value,about:o.value})}).then((function(t){return e(t)}))}(g,E).then((function(e){j.textContent=g.value,J.textContent=E.value,u(q)})).catch((function(e){return console.log(e)}))})),k.addEventListener("submit",(function(n){n.preventDefault(),I.textContent="Сохранить";var o,r=k.querySelector(".popup__input_type_card-name"),c=k.querySelector(".popup__input_type_url");I.textContent="Сохранение...",function(n,o){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n.value,link:o.value})}).then((function(t){return e(t)}))}(r,c).then((function(e){o={name:e.name,link:e.link,likes:e.likes,ownerID:e.owner._id,cardID:e._id}})).then((function(e){f(o),u(b)})).finally((function(e){d(m)})).catch((function(e){return console.log(e)}))})),O=m,console.log(O),Array.from(document.querySelectorAll(O.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);s(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){if(t.validity.patternMismatch){var o=t.dataset.errorMessage;t.setCustomValidity(o)}else t.setCustomValidity("");t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add("".concat(o.inputErrorClass)),r.textContent=n,r.classList.add("".concat(o.errorClass))}(e,t,t.validationMessage,n)}(e,r,t),s(n,o,t)}))}))}(e,O)})),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(t){return e(t)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(t){return e(t)}))]).then((function(e){P.textContent=e[0].name,T.textContent=e[0].about,B.style.backgroundImage="url(".concat(e[0].avatar,")"),_=e[0]._id,e[1].forEach((function(e){f({name:e.name,link:e.link,likes:e.likes,ownerID:e.owner._id,cardID:e._id})}))})).catch((function(e){console.log(e)}))})();